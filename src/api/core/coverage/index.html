<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Core</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.8.0/application.js' type='text/javascript'></script>    
    <link href='./assets/0.8.0/application.css' media='screen, projection, print' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="./assets/0.8.0/favicon_green.png" />
    <link rel="icon" type="image/png" href="./assets/0.8.0/favicon.png" />
  </head>
  
  <body>
    <div id="loading">
      <img src="./assets/0.8.0/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" style="display:none;">
      <div class="timestamp">Generated <abbr class="timeago" title="2015-05-25T21:26:52-04:00">2015-05-25T21:26:52-04:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent"><span class="green">97.5%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         62.14
       </span>
    </span> hits/line)
  </h2>
  <a name="AllFiles"></a>
  <div>
    <b>12</b> files in total.
    <b>560</b> relevant lines. 
    <span class="green"><b>546</b> lines covered</span> and
    <span class="red"><b>14</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#8a2af2d35a2f4d5766d24d8f1be293ef48e1f7a2" class="src_link" title="app/controllers/concerns/doorkeeper_data_authorization.rb">app/controllers/concerns/doorkeeper_data_authorization.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>2.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c88f8a66478601141f2edcc6d388e6adbfeec94b" class="src_link" title="app/controllers/sensit/api_controller.rb">app/controllers/sensit/api_controller.rb</a></td>
        <td class="green strong">95.83 %</td>
        <td>58</td>
        <td>24</td>
        <td>23</td>
        <td>1</td>
        <td>55.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8fa9562c0d073eb431a360f87a3435e3e6d40560" class="src_link" title="app/controllers/sensit/data_controller.rb">app/controllers/sensit/data_controller.rb</a></td>
        <td class="green strong">92.59 %</td>
        <td>53</td>
        <td>27</td>
        <td>25</td>
        <td>2</td>
        <td>3.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#caf9552a91e52f16d6e28ecc6472e1acba1f9d1c" class="src_link" title="app/controllers/sensit/feeds_controller.rb">app/controllers/sensit/feeds_controller.rb</a></td>
        <td class="green strong">90.57 %</td>
        <td>102</td>
        <td>53</td>
        <td>48</td>
        <td>5</td>
        <td>4.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#71909c3aaf94b8295e277ac73c210e98dad4260e" class="src_link" title="app/controllers/sensit/fields_controller.rb">app/controllers/sensit/fields_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>78</td>
        <td>43</td>
        <td>43</td>
        <td>0</td>
        <td>7.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d337c708744fb0d69c87b4572464d3e221371cac" class="src_link" title="app/controllers/sensit/topics_controller.rb">app/controllers/sensit/topics_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>88</td>
        <td>49</td>
        <td>49</td>
        <td>0</td>
        <td>10.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f249e470b2232fba26effa04b79f573cad2fb390" class="src_link" title="app/controllers/sensit/users_controller.rb">app/controllers/sensit/users_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>14</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>1.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e65062e053141ef1fdccf6ac383ca8ef752a4012" class="src_link" title="app/models/sensit/topic.rb">app/models/sensit/topic.rb</a></td>
        <td class="yellow strong">89.19 %</td>
        <td>118</td>
        <td>37</td>
        <td>33</td>
        <td>4</td>
        <td>63.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d81778d6702819757b8c2ac2499131974e071ee2" class="src_link" title="app/models/sensit/topic/feed.rb">app/models/sensit/topic/feed.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>246</td>
        <td>125</td>
        <td>125</td>
        <td>0</td>
        <td>194.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e665d6db39391f9f762ae7be7e854cf27dea8d6d" class="src_link" title="app/models/sensit/topic/feed/importer.rb">app/models/sensit/topic/feed/importer.rb</a></td>
        <td class="green strong">96.77 %</td>
        <td>106</td>
        <td>62</td>
        <td>60</td>
        <td>2</td>
        <td>2.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#77e05fedbb4e4166905fb04d0dbd615df8642380" class="src_link" title="app/models/sensit/topic/field.rb">app/models/sensit/topic/field.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>164</td>
        <td>77</td>
        <td>77</td>
        <td>0</td>
        <td>36.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ad273722bf19f727e86f65932e46235fbbf34fdf" class="src_link" title="lib/sensit/core/factories.rb">lib/sensit/core/factories.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>83</td>
        <td>49</td>
        <td>49</td>
        <td>0</td>
        <td>55.6</td>
      </tr>
      
    </tbody>
  </table>
</div>


        
          <div class="file_list_container" id="Controllers">
  <h2>
    <span class="group_name">Controllers</span>
    (<span class="covered_percent"><span class="green">96.19%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         11.88
       </span>
    </span> hits/line)
  </h2>
  <a name="Controllers"></a>
  <div>
    <b>7</b> files in total.
    <b>210</b> relevant lines. 
    <span class="green"><b>202</b> lines covered</span> and
    <span class="red"><b>8</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#8a2af2d35a2f4d5766d24d8f1be293ef48e1f7a2" class="src_link" title="app/controllers/concerns/doorkeeper_data_authorization.rb">app/controllers/concerns/doorkeeper_data_authorization.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>2.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c88f8a66478601141f2edcc6d388e6adbfeec94b" class="src_link" title="app/controllers/sensit/api_controller.rb">app/controllers/sensit/api_controller.rb</a></td>
        <td class="green strong">95.83 %</td>
        <td>58</td>
        <td>24</td>
        <td>23</td>
        <td>1</td>
        <td>55.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8fa9562c0d073eb431a360f87a3435e3e6d40560" class="src_link" title="app/controllers/sensit/data_controller.rb">app/controllers/sensit/data_controller.rb</a></td>
        <td class="green strong">92.59 %</td>
        <td>53</td>
        <td>27</td>
        <td>25</td>
        <td>2</td>
        <td>3.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#caf9552a91e52f16d6e28ecc6472e1acba1f9d1c" class="src_link" title="app/controllers/sensit/feeds_controller.rb">app/controllers/sensit/feeds_controller.rb</a></td>
        <td class="green strong">90.57 %</td>
        <td>102</td>
        <td>53</td>
        <td>48</td>
        <td>5</td>
        <td>4.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#71909c3aaf94b8295e277ac73c210e98dad4260e" class="src_link" title="app/controllers/sensit/fields_controller.rb">app/controllers/sensit/fields_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>78</td>
        <td>43</td>
        <td>43</td>
        <td>0</td>
        <td>7.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d337c708744fb0d69c87b4572464d3e221371cac" class="src_link" title="app/controllers/sensit/topics_controller.rb">app/controllers/sensit/topics_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>88</td>
        <td>49</td>
        <td>49</td>
        <td>0</td>
        <td>10.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f249e470b2232fba26effa04b79f573cad2fb390" class="src_link" title="app/controllers/sensit/users_controller.rb">app/controllers/sensit/users_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>14</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>1.7</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Models">
  <h2>
    <span class="group_name">Models</span>
    (<span class="covered_percent"><span class="green">98.01%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         98.26
       </span>
    </span> hits/line)
  </h2>
  <a name="Models"></a>
  <div>
    <b>4</b> files in total.
    <b>301</b> relevant lines. 
    <span class="green"><b>295</b> lines covered</span> and
    <span class="red"><b>6</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#e65062e053141ef1fdccf6ac383ca8ef752a4012" class="src_link" title="app/models/sensit/topic.rb">app/models/sensit/topic.rb</a></td>
        <td class="yellow strong">89.19 %</td>
        <td>118</td>
        <td>37</td>
        <td>33</td>
        <td>4</td>
        <td>63.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d81778d6702819757b8c2ac2499131974e071ee2" class="src_link" title="app/models/sensit/topic/feed.rb">app/models/sensit/topic/feed.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>246</td>
        <td>125</td>
        <td>125</td>
        <td>0</td>
        <td>194.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e665d6db39391f9f762ae7be7e854cf27dea8d6d" class="src_link" title="app/models/sensit/topic/feed/importer.rb">app/models/sensit/topic/feed/importer.rb</a></td>
        <td class="green strong">96.77 %</td>
        <td>106</td>
        <td>62</td>
        <td>60</td>
        <td>2</td>
        <td>2.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#77e05fedbb4e4166905fb04d0dbd615df8642380" class="src_link" title="app/models/sensit/topic/field.rb">app/models/sensit/topic/field.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>164</td>
        <td>77</td>
        <td>77</td>
        <td>0</td>
        <td>36.1</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Mailers">
  <h2>
    <span class="group_name">Mailers</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line)
  </h2>
  <a name="Mailers"></a>
  <div>
    <b>0</b> files in total.
    <b>0.0</b> relevant lines. 
    <span class="green"><b>0.0</b> lines covered</span> and
    <span class="red"><b>0.0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Helpers">
  <h2>
    <span class="group_name">Helpers</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line)
  </h2>
  <a name="Helpers"></a>
  <div>
    <b>0</b> files in total.
    <b>0.0</b> relevant lines. 
    <span class="green"><b>0.0</b> lines covered</span> and
    <span class="red"><b>0.0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Libraries">
  <h2>
    <span class="group_name">Libraries</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         55.6
       </span>
    </span> hits/line)
  </h2>
  <a name="Libraries"></a>
  <div>
    <b>1</b> files in total.
    <b>49</b> relevant lines. 
    <span class="green"><b>49</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#ad273722bf19f727e86f65932e46235fbbf34fdf" class="src_link" title="lib/sensit/core/factories.rb">lib/sensit/core/factories.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>83</td>
        <td>49</td>
        <td>49</td>
        <td>0</td>
        <td>55.6</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
      </div>
    
      <div id="footer">
        Generated by <a href="http://github.com/colszowka/simplecov">simplecov</a> v0.8.2 
        and simplecov-html v0.8.0<br/>
        using RSpec
      </div>
    
      <div class="source_files">
      
        <div class="source_table" id="8a2af2d35a2f4d5766d24d8f1be293ef48e1f7a2">
  <div class="header">
    <h3>app/controllers/concerns/doorkeeper_data_authorization.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># module Sensit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">	module DoorkeeperDataAuthorization</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">		extend ::ActiveSupport::Concern</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">		included do</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="5">
          <span class="hits">4</span>
          
          <code class="ruby">			doorkeeper_for :index, :show, :scopes =&gt; [:read_any_data, :read_application_data]</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="6">
          <span class="hits">4</span>
          
          <code class="ruby">			doorkeeper_for :create, :update, :destroy, :scopes =&gt; [:manage_any_data, :manage_application_data]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">			# doorkeeper_for :all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">		end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"># end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="c88f8a66478601141f2edcc6d388e6adbfeec94b">
  <div class="header">
    <h3>app/controllers/sensit/api_controller.rb</h3>
    <h4><span class="green">95.83 %</span> covered</h4>
    <div>
      <b>24</b> relevant lines. 
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Sensit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">	class ApiController &lt; ActionController::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">		# force_ssl if: :ssl_configured?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">		# protect_from_forgery :null_session</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">		# def ssl_configured?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">		# 	true # Rails.env.production?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">		# end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">		def current_user</code>
        </li>
      
        <li class="covered" data-hits="242" data-linenumber="11">
          <span class="hits">242</span>
          
          <code class="ruby">			if doorkeeper_token</code>
        </li>
      
        <li class="covered" data-hits="242" data-linenumber="12">
          <span class="hits">242</span>
          
          <code class="ruby">				@current_user ||= ::Sensit::User.find(doorkeeper_token.resource_owner_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">			end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">		end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">		def current_application</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="17">
          <span class="hits">14</span>
          
          <code class="ruby">			if doorkeeper_token</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="18">
          <span class="hits">14</span>
          
          <code class="ruby">				@current_application ||= ::Doorkeeper::Application.find(doorkeeper_token.application_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">			end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">		end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">		# def user_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">		# 	doorkeeper_token ? doorkeeper_token.resource_owner_id : session[:user_id]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">		# end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">		def attempting_to_write_to_another_application_without_privilage(root_key)</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="27">
          <span class="hits">17</span>
          
          <code class="ruby">			!has_scope?(&quot;manage_any_data&quot;) &amp;&amp; application_id_from_params(root_key).has_key?(:application_id) &amp;&amp; application_id_from_params(root_key)[:application_id].to_s != doorkeeper_token.application_id.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">		end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">		def application_id_from_params(root_key)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="31">
          <span class="hits">2</span>
          
          <code class="ruby">			@application_id_from_params ||= params.require(root_key).permit(:application_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">		end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">		def attempting_to_access_topic_from_another_application_without_privilage(scope)</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="35">
          <span class="hits">96</span>
          
          <code class="ruby">			(!has_scope?(scope) &amp;&amp; (!current_application.topics.map(&amp;:slug).include?(params[:topic_id].to_s)) || !current_user.topics.map(&amp;:slug).include?(params[:topic_id].to_s))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">		end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">		def elastic_index_name</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="39">
          <span class="hits">40</span>
          
          <code class="ruby">			current_user.name.parameterize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">		end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">		def elastic_type_name</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="43">
          <span class="hits">40</span>
          
          <code class="ruby">			params[:topic_id].to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">		end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">		def scoped_owner(scope)</code>
        </li>
      
        <li class="covered" data-hits="101" data-linenumber="47">
          <span class="hits">101</span>
          
          <code class="ruby">			has_scope?(scope) ? current_user : current_application</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">		end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">		def has_scope?(scope)</code>
        </li>
      
        <li class="covered" data-hits="251" data-linenumber="51">
          <span class="hits">251</span>
          
          <code class="ruby">			if doorkeeper_token</code>
        </li>
      
        <li class="covered" data-hits="251" data-linenumber="52">
          <span class="hits">251</span>
          
          <code class="ruby">				doorkeeper_token.scopes.include?(scope)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">			else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">				false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">			end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">		end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="8fa9562c0d073eb431a360f87a3435e3e6d40560">
  <div class="header">
    <h3>app/controllers/sensit/data_controller.rb</h3>
    <h4><span class="green">92.59 %</span> covered</h4>
    <div>
      <b>27</b> relevant lines. 
      <span class="green"><b>25</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require_dependency &quot;sensit/api_controller&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">module Sensit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  class DataController &lt; ApiController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    include ::DoorkeeperDataAuthorization</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    respond_to :json, :xml</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    # GET topics/1/feeds/1/data/:key</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    def show</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="12">
          <span class="hits">8</span>
          
          <code class="ruby">      if attempting_to_access_topic_from_another_application_without_privilage(&quot;read_any_data&quot;)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="13">
          <span class="hits">4</span>
          
          <code class="ruby">        raise ::Elasticsearch::Transport::Transport::Errors::NotFound</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="15">
          <span class="hits">4</span>
          
          <code class="ruby">        response = elastic_client.get(index: elastic_index_name, type: elastic_type_name,:id =&gt; params[:feed_id], :fields =&gt; &quot;#{params[:id]}&quot;)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="16">
          <span class="hits">4</span>
          
          <code class="ruby">        if response[&quot;exists&quot;] || response[&quot;found&quot;]</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="17">
          <span class="hits">4</span>
          
          <code class="ruby">          value = response[&quot;fields&quot;][params[:id]]</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="18">
          <span class="hits">4</span>
          
          <code class="ruby">          render text: value.is_a?(Array) ? value[0] : value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">          raise ::Elasticsearch::Transport::Transport::Errors::NotFound</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    # PATCH/PUT topics/1/feeds/1/data/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">    def update</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="27">
          <span class="hits">7</span>
          
          <code class="ruby">      if attempting_to_access_topic_from_another_application_without_privilage(&quot;manage_any_data&quot;)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="28">
          <span class="hits">2</span>
          
          <code class="ruby">        raise ::Elasticsearch::Transport::Transport::Errors::NotFound</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="30">
          <span class="hits">5</span>
          
          <code class="ruby">        if (data_param.blank?)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">          head :status =&gt; :not_found</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="33">
          <span class="hits">5</span>
          
          <code class="ruby">          response = elastic_client.update(index: elastic_index_name, type: elastic_type_name,:id =&gt; params[:feed_id], :body =&gt; {doc: {params[:id] =&gt; data_param[:value]}})</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="34">
          <span class="hits">5</span>
          
          <code class="ruby">          if response.nil?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">            head :status =&gt; :unprocessable_entity</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="37">
          <span class="hits">4</span>
          
          <code class="ruby">            head :status =&gt; :ok</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">      def elastic_client</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="46">
          <span class="hits">6</span>
          
          <code class="ruby">        @client ||= ENV[&#39;ELASTICSEARCH_URL&#39;] ? ::Elasticsearch::Client.new(url: ENV[&#39;ELASTICSEARCH_URL&#39;]) : ::Elasticsearch::Client.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">      # Only allow a trusted parameter &quot;white list&quot; through.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">      def data_param</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="50">
          <span class="hits">10</span>
          
          <code class="ruby">        params.permit(:value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="caf9552a91e52f16d6e28ecc6472e1acba1f9d1c">
  <div class="header">
    <h3>app/controllers/sensit/feeds_controller.rb</h3>
    <h4><span class="green">90.57 %</span> covered</h4>
    <div>
      <b>53</b> relevant lines. 
      <span class="green"><b>48</b> lines covered</span> and
      <span class="red"><b>5</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require_dependency &quot;sensit/api_controller&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">module Sensit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  class FeedsController &lt; ApiController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    include ::DoorkeeperDataAuthorization</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    respond_to :json, :xml</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    # GET /topics/1/feeds/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    def show</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">      # need to add application_id to feed</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="11">
          <span class="hits">8</span>
          
          <code class="ruby">      if attempting_to_access_topic_from_another_application_without_privilage(&quot;read_any_data&quot;)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="12">
          <span class="hits">4</span>
          
          <code class="ruby">        raise ::Elasticsearch::Transport::Transport::Errors::NotFound</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="14">
          <span class="hits">4</span>
          
          <code class="ruby">        @feed = Topic::Feed.find({index: elastic_index_name, type: elastic_type_name, id: params[:id].to_s})</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="15">
          <span class="hits">4</span>
          
          <code class="ruby">        respond_with(@feed)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    # POST /topic/1/feeds</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    def create</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="21">
          <span class="hits">16</span>
          
          <code class="ruby">      if attempting_to_access_topic_from_another_application_without_privilage(&quot;manage_any_data&quot;)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="22">
          <span class="hits">2</span>
          
          <code class="ruby">        head :unauthorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="24">
          <span class="hits">14</span>
          
          <code class="ruby">        topic = scoped_owner(&quot;manage_any_data&quot;).topics.find(params[:topic_id])</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="25">
          <span class="hits">14</span>
          
          <code class="ruby">        if params.has_key?(:feeds)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">          # have an async option to avoid timeouts and just return immediately with the confirmation that it was received</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="27">
          <span class="hits">2</span>
          
          <code class="ruby">          importer = Topic::Feed::Importer.new({index: elastic_index_name, type: elastic_type_name, :fields =&gt; topic.fields, :feeds =&gt; feeds_params(topic.fields)})</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="28">
          <span class="hits">2</span>
          
          <code class="ruby">          if importer.save</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="29">
          <span class="hits">2</span>
          
          <code class="ruby">            @fields = topic.fields</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="30">
          <span class="hits">2</span>
          
          <code class="ruby">            @feeds = importer.feeds</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="31">
          <span class="hits">2</span>
          
          <code class="ruby">            respond_with(@feeds,:status =&gt; :created, :template =&gt; &quot;sensit/feeds/index&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">            render(:json =&gt; &quot;{\&quot;errors\&quot;:#{importer.errors.to_json}}&quot;, :status =&gt; :unprocessable_entity)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="36">
          <span class="hits">12</span>
          
          <code class="ruby">            @feed = Topic::Feed.new(feed_params(topic.fields).merge!({index: elastic_index_name, type: elastic_type_name})) </code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="37">
          <span class="hits">12</span>
          
          <code class="ruby">            if @feed.save</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="38">
          <span class="hits">10</span>
          
          <code class="ruby">              respond_with(@feed,:status =&gt; :created, :template =&gt; &quot;sensit/feeds/show&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">            else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="40">
          <span class="hits">2</span>
          
          <code class="ruby">              render(:json =&gt; &quot;{\&quot;errors\&quot;:#{@feed.errors.to_json}}&quot;, :status =&gt; :unprocessable_entity)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    # PATCH/PUT /topics/1/feeds/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    def update</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="48">
          <span class="hits">10</span>
          
          <code class="ruby">      if attempting_to_access_topic_from_another_application_without_privilage(&quot;manage_any_data&quot;)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="49">
          <span class="hits">2</span>
          
          <code class="ruby">        raise ::Elasticsearch::Transport::Transport::Errors::NotFound</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="51">
          <span class="hits">8</span>
          
          <code class="ruby">        @feed = Topic::Feed.find({index: elastic_index_name, type: elastic_type_name, id: params[:id].to_s})        </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="52">
          <span class="hits">8</span>
          
          <code class="ruby">        if @feed.update_attributes(feed_update_params(@feed.fields))</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="53">
          <span class="hits">5</span>
          
          <code class="ruby">          respond_with(@feed,:status =&gt; :ok, :template =&gt; &quot;sensit/feeds/show&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="55">
          <span class="hits">3</span>
          
          <code class="ruby">          render(:json =&gt; &quot;{\&quot;errors\&quot;:#{@feed.errors.to_json}}&quot;, :status =&gt; :unprocessable_entity)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">    # DELETE /topics/1/feeds/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">    def destroy</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="62">
          <span class="hits">8</span>
          
          <code class="ruby">      if attempting_to_access_topic_from_another_application_without_privilage(&quot;manage_any_data&quot;)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="63">
          <span class="hits">3</span>
          
          <code class="ruby">        raise ::Elasticsearch::Transport::Transport::Errors::NotFound</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="65">
          <span class="hits">5</span>
          
          <code class="ruby">        Topic::Feed.destroy({index: elastic_index_name, type: elastic_type_name, id:  params[:id].to_s})</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="66">
          <span class="hits">5</span>
          
          <code class="ruby">        head :status =&gt; :no_content</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">      # Use callbacks to share common setup or constraints between actions.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">      # Only allow a trusted parameter &quot;white list&quot; through.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">      def feed_update_params(fields)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="75">
          <span class="hits">8</span>
          
          <code class="ruby">        values = fields.map(&amp;:key)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="76">
          <span class="hits">8</span>
          
          <code class="ruby">        params.require(:feed).require(:data).permit(values)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">      def feed_params(fields)</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="80">
          <span class="hits">12</span>
          
          <code class="ruby">        if fields.empty?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="81">
          
          
          <code class="ruby">          feed_hash = params.require(:feed).permit(:at, :tz).tap do |whitelisted|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="82">
          
          
          <code class="ruby">            whitelisted[:data] =  params[:feed][:data]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="85">
          <span class="hits">12</span>
          
          <code class="ruby">          feed_hash = params.require(:feed).permit(:at, :tz, :data =&gt; fields.map(&amp;:key))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="87">
          <span class="hits">12</span>
          
          <code class="ruby">        feed_hash.merge!(fields: fields)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">      def feeds_params(fields)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="91">
          <span class="hits">2</span>
          
          <code class="ruby">        values = fields.map(&amp;:key)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="92">
          <span class="hits">2</span>
          
          <code class="ruby">        if params[:feeds] &amp;&amp; params[:feeds].is_a?(Hash)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="93">
          
          
          <code class="ruby">          params.require(:feeds).map do |p|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="94">
          
          
          <code class="ruby">            ActionController::Parameters.new(p.to_hash).permit(:at, :tz, :data =&gt; values)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="97">
          <span class="hits">2</span>
          
          <code class="ruby">          params.require(:feeds)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="71909c3aaf94b8295e277ac73c210e98dad4260e">
  <div class="header">
    <h3>app/controllers/sensit/fields_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>43</b> relevant lines. 
      <span class="green"><b>43</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require_dependency &quot;sensit/api_controller&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">module Sensit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  class FieldsController &lt; ApiController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    include ::DoorkeeperDataAuthorization    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    respond_to :json, :xml</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    # GET /topics/1/fields</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def index</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="9">
          <span class="hits">7</span>
          
          <code class="ruby">      if has_scope?(&quot;read_any_data&quot;)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="10">
          <span class="hits">6</span>
          
          <code class="ruby">        @fields = Topic::Field.joins(:topic, :topic =&gt; :user).where(:sensit_topics =&gt; {:slug =&gt; params[:topic_id]}, :sensit_users =&gt; {:id =&gt; doorkeeper_token.resource_owner_id}).page(params[:page] || 1).per(params[:per] || 10)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">        @fields = Topic::Field.joins(:topic).where(:sensit_topics =&gt; {:slug =&gt; params[:topic_id], application_id: doorkeeper_token.application_id}).page(params[:page] || 1).per(params[:per] || 10)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="14">
          <span class="hits">7</span>
          
          <code class="ruby">      respond_with(@fields)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    # GET /topics/1/fields/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    def show</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="19">
          <span class="hits">8</span>
          
          <code class="ruby">      @field = set_field_in_scope(&quot;read_any_data&quot;)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="20">
          <span class="hits">4</span>
          
          <code class="ruby">      respond_with(@field)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    # POST /topics/1/fields</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    def create</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="25">
          <span class="hits">20</span>
          
          <code class="ruby">      if (attempting_to_access_topic_from_another_application_without_privilage(&quot;manage_any_data&quot;))</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="26">
          <span class="hits">2</span>
          
          <code class="ruby">        head :unauthorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="28">
          <span class="hits">18</span>
          
          <code class="ruby">        topic = scoped_owner(&quot;manage_any_data&quot;).topics.find(params[:topic_id])</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="29">
          <span class="hits">18</span>
          
          <code class="ruby">        @field = topic.fields.build(field_params)</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="30">
          <span class="hits">18</span>
          
          <code class="ruby">        if @field.save</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="31">
          <span class="hits">8</span>
          
          <code class="ruby">          respond_with(@field,:status =&gt; :created, :template =&gt; &quot;sensit/fields/show&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="33">
          <span class="hits">10</span>
          
          <code class="ruby">          render(:json =&gt; &quot;{\&quot;errors\&quot;:#{@field.errors.to_json}}&quot;, :status =&gt; :unprocessable_entity)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    # PATCH/PUT /topics/1/fields/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    def update</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="40">
          <span class="hits">11</span>
          
          <code class="ruby">      if (attempting_to_access_topic_from_another_application_without_privilage(&quot;manage_any_data&quot;))</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="41">
          <span class="hits">2</span>
          
          <code class="ruby">        raise ActiveRecord::RecordNotFound</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="43">
          <span class="hits">9</span>
          
          <code class="ruby">        @field = set_field_in_scope(&quot;manage_any_data&quot;)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="44">
          <span class="hits">9</span>
          
          <code class="ruby">        if @field.update(field_params)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="45">
          <span class="hits">6</span>
          
          <code class="ruby">          respond_with(@field,:status =&gt; :ok, :template =&gt; &quot;sensit/fields/show&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="47">
          <span class="hits">3</span>
          
          <code class="ruby">          render(:json =&gt; &quot;{\&quot;errors\&quot;:#{@field.errors.to_json}}&quot;, :status =&gt; :unprocessable_entity)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">    # DELETE topics/1/fields/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">    def destroy</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="54">
          <span class="hits">8</span>
          
          <code class="ruby">      if attempting_to_access_topic_from_another_application_without_privilage(&quot;manage_any_data&quot;)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="55">
          <span class="hits">3</span>
          
          <code class="ruby">        raise ActiveRecord::RecordNotFound</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="57">
          <span class="hits">5</span>
          
          <code class="ruby">        @field = set_field_in_scope(&quot;manage_any_data&quot;)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="58">
          <span class="hits">5</span>
          
          <code class="ruby">        @field.destroy</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="59">
          <span class="hits">5</span>
          
          <code class="ruby">        head :status =&gt; :no_content</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">      # Use callbacks to share common setup or constraints between actions.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">      def set_field_in_scope(scope)</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="66">
          <span class="hits">22</span>
          
          <code class="ruby">        topic = scoped_owner(scope).topics.find(params[:topic_id])</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="67">
          <span class="hits">18</span>
          
          <code class="ruby">        raise ActiveRecord::RecordNotFound if topic.blank?</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="68">
          <span class="hits">18</span>
          
          <code class="ruby">        field = topic.fields.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="69">
          <span class="hits">18</span>
          
          <code class="ruby">        raise ActiveRecord::RecordNotFound if field.blank?</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="70">
          <span class="hits">18</span>
          
          <code class="ruby">        field</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">      # Only allow a trusted parameter &quot;white list&quot; through.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">      def field_params</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="75">
          <span class="hits">27</span>
          
          <code class="ruby">        params.require(:field).permit(:name, :key)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d337c708744fb0d69c87b4572464d3e221371cac">
  <div class="header">
    <h3>app/controllers/sensit/topics_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>49</b> relevant lines. 
      <span class="green"><b>49</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require_dependency &quot;sensit/api_controller&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">module Sensit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  class TopicsController &lt; ApiController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    include ::DoorkeeperDataAuthorization</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    respond_to :json, :xml</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    # GET 1/topics</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def index</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="9">
          <span class="hits">9</span>
          
          <code class="ruby">      @topics = scoped_owner(&quot;read_any_data&quot;).topics.page(params[:page] || 1).per(params[:per] || 10)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="10">
          <span class="hits">9</span>
          
          <code class="ruby">      respond_with(@topics)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    # GET 1/topics/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    def show</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="15">
          <span class="hits">9</span>
          
          <code class="ruby">      @topic = scoped_owner(&quot;read_any_data&quot;).topics.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="16">
          <span class="hits">5</span>
          
          <code class="ruby">      respond_with(@topic)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    # POST 1/topics</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    def create</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="21">
          <span class="hits">17</span>
          
          <code class="ruby">      if (attempting_to_write_to_another_application_without_privilage(:topic))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">        head :unauthorized</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="24">
          <span class="hits">16</span>
          
          <code class="ruby">        @topic = current_user.topics.build(topic_params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">        fields_params.each do |field_set|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="27">
          <span class="hits">4</span>
          
          <code class="ruby">          @topic.fields.build(field_set)</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="28">
          <span class="hits">16</span>
          
          <code class="ruby">        end unless fields_params.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="30">
          <span class="hits">16</span>
          
          <code class="ruby">        if @topic.save</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="31">
          <span class="hits">12</span>
          
          <code class="ruby">          respond_with(@topic,:status =&gt; :created, :template =&gt; &quot;sensit/topics/show&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="33">
          <span class="hits">4</span>
          
          <code class="ruby">          render(:json =&gt; &quot;{\&quot;errors\&quot;:#{@topic.errors.to_json}}&quot;, :status =&gt; :unprocessable_entity)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    # PATCH/PUT 1/topics/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    def update</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="40">
          <span class="hits">16</span>
          
          <code class="ruby">      @topic = scoped_owner(&quot;manage_any_data&quot;).topics.find(params[:id])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">      fields_params.each do |field_set|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">        field = @topic.fields.where(:key =&gt; field_set[:key]).first</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">        field.name = field_set[:name]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">        field.save</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="46">
          <span class="hits">14</span>
          
          <code class="ruby">      end unless fields_params.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="48">
          <span class="hits">14</span>
          
          <code class="ruby">      if @topic.update(topic_params)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="49">
          <span class="hits">11</span>
          
          <code class="ruby">        respond_with(@topic, :status =&gt; 200, :template =&gt; &quot;sensit/topics/show&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="51">
          <span class="hits">3</span>
          
          <code class="ruby">        render(:json =&gt; &quot;{\&quot;errors\&quot;:#{@topic.errors.to_json}}&quot;, :status =&gt; :unprocessable_entity)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">    # DELETE 1/topics/1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">    def destroy</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="57">
          <span class="hits">10</span>
          
          <code class="ruby">      @topic = scoped_owner(&quot;manage_any_data&quot;).topics.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="58">
          <span class="hits">7</span>
          
          <code class="ruby">      @topic.destroy</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="59">
          <span class="hits">7</span>
          
          <code class="ruby">      head :status =&gt; :no_content</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">      # Only allow a trusted parameter &quot;white list&quot; through.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">      def topic_params</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="65">
          <span class="hits">30</span>
          
          <code class="ruby">        @topic_params ||= strong_topic_params</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">      def strong_topic_params</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="69">
          <span class="hits">30</span>
          
          <code class="ruby">        permitted_attributes = [:name, :description, :ttl]</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="70">
          <span class="hits">30</span>
          
          <code class="ruby">        permitted_attributes &lt;&lt; :application_id if has_scope?(&quot;manage_any_data&quot;)</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="71">
          <span class="hits">30</span>
          
          <code class="ruby">        topic_params = params.require(:topic).permit(permitted_attributes)</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="72">
          <span class="hits">30</span>
          
          <code class="ruby">        topic_params.merge!(application_id: doorkeeper_token.application_id) unless topic_params.has_key?(:application_id)</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="73">
          <span class="hits">30</span>
          
          <code class="ruby">        topic_params</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">      def fields_params</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="77">
          <span class="hits">33</span>
          
          <code class="ruby">        if @fields_params</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="78">
          <span class="hits">3</span>
          
          <code class="ruby">          @fields_params</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="79">
          <span class="hits">30</span>
          
          <code class="ruby">        elsif (params.require(:topic)[:fields].present? &amp;&amp; params[:topic][:fields].is_a?(Array))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">          @fields_params ||= params[:topic][:fields].map do |field_attributes|</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="81">
          <span class="hits">5</span>
          
          <code class="ruby">            ActionController::Parameters.new(field_attributes.to_hash).permit(:key, :name)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="82">
          <span class="hits">3</span>
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="84">
          <span class="hits">27</span>
          
          <code class="ruby">          []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">      end  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f249e470b2232fba26effa04b79f573cad2fb390">
  <div class="header">
    <h3>app/controllers/sensit/users_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>9</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require_dependency &quot;sensit/api_controller&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">module Sensit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  class UsersController &lt; ApiController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    respond_to :json, :xml</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    # doorkeeper_for :show, :scopes =&gt; [:read_any_data, :manage_any_data, :read_any_percolations, :manage_any_percolations, :read_any_reports, :manage_any_reports, :read_any_subscriptions, :manage_any_subscriptions]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">	doorkeeper_for :all    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def show</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="9">
          <span class="hits">3</span>
          
          <code class="ruby">      @user = current_user</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="10">
          <span class="hits">3</span>
          
          <code class="ruby">      @topics = scoped_owner(&quot;read_any_data&quot;).topics</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="11">
          <span class="hits">3</span>
          
          <code class="ruby">      respond_with @user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e65062e053141ef1fdccf6ac383ca8ef752a4012">
  <div class="header">
    <h3>app/models/sensit/topic.rb</h3>
    <h4><span class="yellow">89.19 %</span> covered</h4>
    <div>
      <b>37</b> relevant lines. 
      <span class="green"><b>33</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Sensit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class Topic &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">	extend ::FriendlyId</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">	friendly_id :name, use: [:slugged, :finders]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  	after_destroy :destroy_feeds</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  	belongs_to :user, class_name: &quot;Sensit::User&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  	belongs_to :application, class_name: &quot;::Doorkeeper::Application&quot;, foreign_key: &quot;application_id&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">	</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">	validates :name, presence: true, uniqueness: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">	has_many :fields, dependent: :destroy, :class_name =&gt; &quot;Sensit::Topic::Field&quot;	</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">	# delegate :name, :to =&gt; :node, :prefix =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">	def feeds(params = {})</code>
        </li>
      
        <li class="covered" data-hits="77" data-linenumber="17">
          <span class="hits">77</span>
          
          <code class="ruby">		body = params[:body] || {:query =&gt; {&quot;match_all&quot; =&gt; {  }}}</code>
        </li>
      
        <li class="covered" data-hits="77" data-linenumber="18">
          <span class="hits">77</span>
          
          <code class="ruby">        sort = params[:sort] || &quot;at:asc&quot;</code>
        </li>
      
        <li class="covered" data-hits="77" data-linenumber="19">
          <span class="hits">77</span>
          
          <code class="ruby">        per = params[:per] || 10</code>
        </li>
      
        <li class="covered" data-hits="77" data-linenumber="20">
          <span class="hits">77</span>
          
          <code class="ruby">        from = ((params[:page] || 1)-1) * per</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">        # Sort is not included right now because it causes an exception when there are no documents in the index</code>
        </li>
      
        <li class="covered" data-hits="77" data-linenumber="22">
          <span class="hits">77</span>
          
          <code class="ruby">        begin</code>
        </li>
      
        <li class="covered" data-hits="77" data-linenumber="23">
          <span class="hits">77</span>
          
          <code class="ruby">        	Topic::Feed.search({index: elastic_index_name, type: elastic_type_name, body: body, size: per, from: from})</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">		rescue Exception =&gt; exc</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">			logger.error(&quot;Exception when trying to search for feeds: #{exc.message}&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">			[]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">		end        	</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">	def create_mapping</code>
        </li>
      
        <li class="covered" data-hits="138" data-linenumber="32">
          <span class="hits">138</span>
          
          <code class="ruby">		client = ENV[&#39;ELASTICSEARCH_URL&#39;] ? ::Elasticsearch::Client.new(url: ENV[&#39;ELASTICSEARCH_URL&#39;]) : ::Elasticsearch::Client.new</code>
        </li>
      
        <li class="covered" data-hits="138" data-linenumber="33">
          <span class="hits">138</span>
          
          <code class="ruby">		field_properties = fields.inject({}) do |h, field|</code>
        </li>
      
        <li class="covered" data-hits="162" data-linenumber="34">
          <span class="hits">162</span>
          
          <code class="ruby">			h.merge!({field.key =&gt; field.properties})</code>
        </li>
      
        <li class="covered" data-hits="162" data-linenumber="35">
          <span class="hits">162</span>
          
          <code class="ruby">			h</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">		end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">		# if there are many fields then add the store function to specific fields that are accessed frequently</code>
        </li>
      
        <li class="covered" data-hits="138" data-linenumber="39">
          <span class="hits">138</span>
          
          <code class="ruby">		if client.indices.exists(index: elastic_index_name)</code>
        </li>
      
        <li class="covered" data-hits="138" data-linenumber="40">
          <span class="hits">138</span>
          
          <code class="ruby">			client.indices.put_mapping({index: elastic_index_name, type: elastic_type_name, body:{mapping:{ elastic_type_name =&gt; {properties: field_properties}}}})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">		else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">			client.indices.create({index: elastic_index_name, body:{ mapping:{ elastic_type_name =&gt; {properties: field_properties}}}})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">		end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="138" data-linenumber="45">
          <span class="hits">138</span>
          
          <code class="ruby">		self.is_initialized = true</code>
        </li>
      
        <li class="covered" data-hits="138" data-linenumber="46">
          <span class="hits">138</span>
          
          <code class="ruby">		self.save		</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">	# client.indices.create index: &#39;test&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"> #                      body: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"> #                        settings: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"> #                          index: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby"> #                            number_of_shards: 1,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"> #                            number_of_replicas: 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"> #                            &#39;routing.allocation.include.name&#39; =&gt; &#39;node-1&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"> #                          },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"> #                          analysis: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"> #                            filter: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"> #                              ngram: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"> #                                type: &#39;nGram&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"> #                                min_gram: 3,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"> #                                max_gram: 25</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"> #                              }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"> #                            },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"> #                            analyzer: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"> #                              ngram: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby"> #                                tokenizer: &#39;whitespace&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"> #                                filter: [&#39;lowercase&#39;, &#39;stop&#39;, &#39;ngram&#39;],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"> #                                type: &#39;custom&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"> #                              },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby"> #                              ngram_search: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"> #                                tokenizer: &#39;whitespace&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"> #                                filter: [&#39;lowercase&#39;, &#39;stop&#39;],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"> #                                type: &#39;custom&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"> #                              }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"> #                            }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby"> #                          }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby"> #                        },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby"> #                        mappings: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"> #                          document: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby"> #                            properties: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby"> #                              title: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby"> #                                type: &#39;multi_field&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby"> #                                fields: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby"> #                                    title:  { type: &#39;string&#39;, analyzer: &#39;snowball&#39; },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby"> #                                    exact:  { type: &#39;string&#39;, analyzer: &#39;keyword&#39; },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby"> #                                    ngram:  { type: &#39;string&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby"> #                                              index_analyzer: &#39;ngram&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby"> #                                              search_analyzer: &#39;ngram_search&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby"> #                                    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"> #                                }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby"> #                              }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby"> #                            }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby"> #                          }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby"> #                        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby"> #                      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">	</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">	def destroy_feeds</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">		# client = ::Elasticsearch::Client.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">		</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">		# TODO change to delete_by_query when it works properly</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="101">
          <span class="hits">8</span>
          
          <code class="ruby">		feeds.each do |feed|</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="102">
          <span class="hits">16</span>
          
          <code class="ruby">			feed.destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">		end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">		# client.delete_by_query({index: elastic_index_name, type: elastic_type_name, body: { query: { term: { topic_id: self.id } } }})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">	# lazily create the index in elastic search upon the first addition of any data to a feed</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="108">
          <span class="hits">1</span>
          
          <code class="ruby">private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">	def elastic_index_name</code>
        </li>
      
        <li class="covered" data-hits="353" data-linenumber="112">
          <span class="hits">353</span>
          
          <code class="ruby">		user.name.parameterize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">	def elastic_type_name</code>
        </li>
      
        <li class="covered" data-hits="353" data-linenumber="115">
          <span class="hits">353</span>
          
          <code class="ruby">		self.to_param</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">	end   </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d81778d6702819757b8c2ac2499131974e071ee2">
  <div class="header">
    <h3>app/models/sensit/topic/feed.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>125</b> relevant lines. 
      <span class="green"><b>125</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Sensit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class Topic::Feed</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  	include ::ActiveModel::Model</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  	    #  extend  ActiveModel::Naming</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">        # extend  ActiveModel::Translation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">        # include ActiveModel::Validations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">        # include ActiveModel::Conversion</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">	extend ::ActiveModel::Callbacks</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">	include ::ActiveModel::Dirty</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">	# include ElasticUniquenessValidator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  	define_model_callbacks :create, :update, :save, :destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  	attr_accessor :at, :type, :index, :fields</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">	attr_reader :errors, :id, :data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">	def initialize(params={})</code>
        </li>
      
        <li class="covered" data-hits="662" data-linenumber="17">
          <span class="hits">662</span>
          
          <code class="ruby">    	@new_record = true</code>
        </li>
      
        <li class="covered" data-hits="662" data-linenumber="18">
          <span class="hits">662</span>
          
          <code class="ruby">    	@type = params.delete(:type)</code>
        </li>
      
        <li class="covered" data-hits="662" data-linenumber="19">
          <span class="hits">662</span>
          
          <code class="ruby">    	@index = params.delete(:index)</code>
        </li>
      
        <li class="covered" data-hits="662" data-linenumber="20">
          <span class="hits">662</span>
          
          <code class="ruby">    	t = params.delete(:at)</code>
        </li>
      
        <li class="covered" data-hits="662" data-linenumber="21">
          <span class="hits">662</span>
          
          <code class="ruby">    	self.at = self.class.convert_to_time(t || Time.now)</code>
        </li>
      
        <li class="covered" data-hits="662" data-linenumber="22">
          <span class="hits">662</span>
          
          <code class="ruby">    	extracted_fields = params.delete(:fields)</code>
        </li>
      
        <li class="covered" data-hits="662" data-linenumber="23">
          <span class="hits">662</span>
          
          <code class="ruby">    	self.fields = extracted_fields.nil? ? (self.topic.nil? ? [] : topic.fields) : extracted_fields</code>
        </li>
      
        <li class="covered" data-hits="662" data-linenumber="24">
          <span class="hits">662</span>
          
          <code class="ruby">    	tz = params.delete(:tz)</code>
        </li>
      
        <li class="covered" data-hits="662" data-linenumber="25">
          <span class="hits">662</span>
          
          <code class="ruby">    	self.at = self.at.in_time_zone(tz) if self.at.present? &amp;&amp; tz.present? &amp;&amp; ::ActiveSupport::TimeZone.zones_map.keys.include?(tz)</code>
        </li>
      
        <li class="covered" data-hits="662" data-linenumber="26">
          <span class="hits">662</span>
          
          <code class="ruby">    	super(params)</code>
        </li>
      
        <li class="covered" data-hits="662" data-linenumber="27">
          <span class="hits">662</span>
          
          <code class="ruby">		convert_rawdata_to_datatype unless self.data.blank?</code>
        </li>
      
        <li class="covered" data-hits="662" data-linenumber="28">
          <span class="hits">662</span>
          
          <code class="ruby">    	@errors = ActiveModel::Errors.new(self)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">	validates :index, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">	validates :type, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">	# validates :at, presence: true, elastic_uniqueness: {scope: [:topic_id]}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">	validates :at, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">	validates :data, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">	def data=(value)</code>
        </li>
      
        <li class="covered" data-hits="644" data-linenumber="38">
          <span class="hits">644</span>
          
          <code class="ruby"> 		@data = ActiveSupport::HashWithIndifferentAccess.new(value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  	def self.find(arguments = {})</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="42">
          <span class="hits">16</span>
          
          <code class="ruby">		result = elastic_client.get arguments</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="43">
          <span class="hits">14</span>
          
          <code class="ruby">		fields = Topic::Field.joins(:topic).where(sensit_topics:{slug: arguments[:type]}).load if arguments[:type]</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="44">
          <span class="hits">14</span>
          
          <code class="ruby">		result.nil? ? nil : map_results(result, fields)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">	def self.search(arguments = {})</code>
        </li>
      
        <li class="covered" data-hits="79" data-linenumber="48">
          <span class="hits">79</span>
          
          <code class="ruby">		results = elastic_client.search arguments</code>
        </li>
      
        <li class="covered" data-hits="79" data-linenumber="49">
          <span class="hits">79</span>
          
          <code class="ruby">		fields = Topic::Field.joins(:topic).where(sensit_topics:{slug: arguments[:type]}).load if arguments[:type]</code>
        </li>
      
        <li class="covered" data-hits="282" data-linenumber="50">
          <span class="hits">282</span>
          
          <code class="ruby">		results[&quot;hits&quot;][&quot;hits&quot;].inject([]) {|arr, result| arr &lt;&lt; map_results(result, fields)}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">	def self.percolate(arguments = {})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">		# result = elastic_client.percolate arguments</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">	def self.count(arguments = {})</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="58">
          <span class="hits">12</span>
          
          <code class="ruby">		result = elastic_client.count arguments</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="59">
          <span class="hits">12</span>
          
          <code class="ruby">		result[&quot;count&quot;].to_i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">	def self.create(arguments = {})</code>
        </li>
      
        <li class="covered" data-hits="393" data-linenumber="63">
          <span class="hits">393</span>
          
          <code class="ruby">		feed = self.new(arguments)</code>
        </li>
      
        <li class="covered" data-hits="393" data-linenumber="64">
          <span class="hits">393</span>
          
          <code class="ruby">		feed.send(:create)</code>
        </li>
      
        <li class="covered" data-hits="393" data-linenumber="65">
          <span class="hits">393</span>
          
          <code class="ruby">		feed</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">	def self.destroy(arguments = {})</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="69">
          <span class="hits">7</span>
          
          <code class="ruby">		id = arguments.delete(:id)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="70">
          <span class="hits">7</span>
          
          <code class="ruby">		feed = self.new(arguments.merge!(fields: []))</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="71">
          <span class="hits">7</span>
          
          <code class="ruby">		feed.instance_variable_set(:@id, id)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="72">
          <span class="hits">7</span>
          
          <code class="ruby">		feed.instance_variable_set(:@new_record, false)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="73">
          <span class="hits">7</span>
          
          <code class="ruby">		feed.destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">	def self.destroy_all(arguments = {})</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="77">
          <span class="hits">2</span>
          
          <code class="ruby">		elastic_client.indices.delete arguments</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">	def new_record?</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="81">
          <span class="hits">44</span>
          
          <code class="ruby">		@new_record || false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">	def save</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="85">
          <span class="hits">15</span>
          
          <code class="ruby">		run_callbacks :save do</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="86">
          <span class="hits">15</span>
          
          <code class="ruby">			valid? ? (new_record? ? create : update) : false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">		end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">	end	</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">	def destroy</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="91">
          <span class="hits">24</span>
          
          <code class="ruby">		raise ::Elasticsearch::Transport::Transport::Errors::BadRequest.new if new_record? || id.nil?</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="92">
          <span class="hits">23</span>
          
          <code class="ruby">		run_callbacks :destroy do</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="93">
          <span class="hits">23</span>
          
          <code class="ruby">			elastic_client.delete({index: self.index, type: self.type, id: self.id}) #if elastic_client.exists({index: self.index, id: self.id})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">		end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">	def percolate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">		# elastic_client.percolate attributes_for_percolate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">	def topic</code>
        </li>
      
        <li class="covered" data-hits="1755" data-linenumber="102">
          <span class="hits">1755</span>
          
          <code class="ruby">		@topic ||= Topic.find_by(slug: self.type)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="105">
          <span class="hits">1</span>
          
          <code class="ruby">	def topic=(record)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="106">
          <span class="hits">2</span>
          
          <code class="ruby">		raise ::TypeError.new(&quot;Not a Topic&quot;) unless record.instance_of? Topic</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">		self.type = record.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">	delegate :name, :to =&gt; :topic, :prefix =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">	delegate :node_name, :to =&gt; :topic, :prefix =&gt; false</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">	delegate :ttl, :to =&gt; :topic, :prefix =&gt; false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">	# need a custom validation to ensure that the data value is the datatype that is expected based on the field value type and that the key is correct as well</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">	# def validate!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">	# 	errors.add(:name, &quot;can not be nil&quot;) if name.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">	# end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">	# def self.human_attribute_name(attr, options = {})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">	# 	&quot;Name&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">	# end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="124">
          <span class="hits">1</span>
          
          <code class="ruby">	def update_attributes(params)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="125">
          <span class="hits">7</span>
          
          <code class="ruby">		self.data.merge!(params)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="126">
          <span class="hits">7</span>
          
          <code class="ruby">		save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">	def to_hash</code>
        </li>
      
        <li class="covered" data-hits="417" data-linenumber="130">
          <span class="hits">417</span>
          
          <code class="ruby">		body = self.data.clone</code>
        </li>
      
        <li class="covered" data-hits="417" data-linenumber="131">
          <span class="hits">417</span>
          
          <code class="ruby">		body.merge!({at:self.at.to_f, tz: (self.at.time_zone.name || &quot;UTC&quot;)})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">	def self.map_results(result, fields)</code>
        </li>
      
        <li class="covered" data-hits="215" data-linenumber="137">
          <span class="hits">215</span>
          
          <code class="ruby">		t = result[&quot;_source&quot;].delete(&quot;at&quot;)</code>
        </li>
      
        <li class="covered" data-hits="215" data-linenumber="138">
          <span class="hits">215</span>
          
          <code class="ruby">		tz = result[&quot;_source&quot;].delete(&quot;tz&quot;)</code>
        </li>
      
        <li class="covered" data-hits="215" data-linenumber="139">
          <span class="hits">215</span>
          
          <code class="ruby">		at = Time.at(t) unless t.nil?</code>
        </li>
      
        <li class="covered" data-hits="215" data-linenumber="140">
          <span class="hits">215</span>
          
          <code class="ruby">		body = result[&quot;_source&quot;]</code>
        </li>
      
        <li class="covered" data-hits="215" data-linenumber="141">
          <span class="hits">215</span>
          
          <code class="ruby">		obj = self.new({index: result[&quot;_index&quot;], type: result[&quot;_type&quot;], at: at, tz: tz, data: body, fields:fields})</code>
        </li>
      
        <li class="covered" data-hits="215" data-linenumber="142">
          <span class="hits">215</span>
          
          <code class="ruby">		obj.instance_variable_set(:@id, result[&quot;_id&quot;])</code>
        </li>
      
        <li class="covered" data-hits="215" data-linenumber="143">
          <span class="hits">215</span>
          
          <code class="ruby">		obj.instance_variable_set(:@new_record, false)</code>
        </li>
      
        <li class="covered" data-hits="215" data-linenumber="144">
          <span class="hits">215</span>
          
          <code class="ruby">		obj</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="147">
          <span class="hits">1</span>
          
          <code class="ruby">	def self.elastic_client</code>
        </li>
      
        <li class="covered" data-hits="525" data-linenumber="148">
          <span class="hits">525</span>
          
          <code class="ruby">		@@client ||= ENV[&#39;ELASTICSEARCH_URL&#39;] ? ::Elasticsearch::Client.new(url: ENV[&#39;ELASTICSEARCH_URL&#39;]) : ::Elasticsearch::Client.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">	def elastic_client</code>
        </li>
      
        <li class="covered" data-hits="430" data-linenumber="152">
          <span class="hits">430</span>
          
          <code class="ruby">		self.class.elastic_client</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="155">
          <span class="hits">1</span>
          
          <code class="ruby">	def attributes_to_create</code>
        </li>
      
        <li class="covered" data-hits="403" data-linenumber="156">
          <span class="hits">403</span>
          
          <code class="ruby">		{index: index, type: type, body: self.to_hash}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="159">
          <span class="hits">1</span>
          
          <code class="ruby">	def attributes_to_update</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="160">
          <span class="hits">7</span>
          
          <code class="ruby">		{index: index, type: type, id: id, body: {doc: self.to_hash} }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">	def attributes_for_percolate</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">		{index: index, type: type, body: {doc: self.to_hash} }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">	def update</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="168">
          <span class="hits">7</span>
          
          <code class="ruby">		run_callbacks :update do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="169">
          <span class="hits">7</span>
          
          <code class="ruby">			response = elastic_client.update attributes_to_update</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="170">
          <span class="hits">7</span>
          
          <code class="ruby">			!response.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">		end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">	def create</code>
        </li>
      
        <li class="covered" data-hits="403" data-linenumber="175">
          <span class="hits">403</span>
          
          <code class="ruby">		run_callbacks :create do</code>
        </li>
      
        <li class="covered" data-hits="403" data-linenumber="176">
          <span class="hits">403</span>
          
          <code class="ruby">			if topic &amp;&amp; !topic.is_initialized</code>
        </li>
      
        <li class="covered" data-hits="138" data-linenumber="177">
          <span class="hits">138</span>
          
          <code class="ruby">				data.each_pair do |key, value|</code>
        </li>
      
        <li class="covered" data-hits="162" data-linenumber="178">
          <span class="hits">162</span>
          
          <code class="ruby">					field = self.fields.find_or_initialize_by(key: key.to_s.parameterize)</code>
        </li>
      
        <li class="covered" data-hits="162" data-linenumber="179">
          <span class="hits">162</span>
          
          <code class="ruby">					field.name = key.to_s if field.name.blank?</code>
        </li>
      
        <li class="covered" data-hits="162" data-linenumber="180">
          <span class="hits">162</span>
          
          <code class="ruby">					field.datatype = field.guess_datatype(value) if field.datatype.nil?</code>
        </li>
      
        <li class="covered" data-hits="162" data-linenumber="181">
          <span class="hits">162</span>
          
          <code class="ruby">					field.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">				end</code>
        </li>
      
        <li class="covered" data-hits="138" data-linenumber="183">
          <span class="hits">138</span>
          
          <code class="ruby">				topic.create_mapping</code>
        </li>
      
        <li class="covered" data-hits="138" data-linenumber="184">
          <span class="hits">138</span>
          
          <code class="ruby">				convert_rawdata_to_datatype</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby">			end</code>
        </li>
      
        <li class="covered" data-hits="403" data-linenumber="186">
          <span class="hits">403</span>
          
          <code class="ruby">			response = elastic_client.create attributes_to_create</code>
        </li>
      
        <li class="covered" data-hits="403" data-linenumber="187">
          <span class="hits">403</span>
          
          <code class="ruby">			success = response[&quot;ok&quot;] || response[&quot;created&quot;] || false</code>
        </li>
      
        <li class="covered" data-hits="403" data-linenumber="188">
          <span class="hits">403</span>
          
          <code class="ruby">			if (success)</code>
        </li>
      
        <li class="covered" data-hits="403" data-linenumber="189">
          <span class="hits">403</span>
          
          <code class="ruby">				@new_record = false</code>
        </li>
      
        <li class="covered" data-hits="403" data-linenumber="190">
          <span class="hits">403</span>
          
          <code class="ruby">				@id = response[&quot;_id&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">			end</code>
        </li>
      
        <li class="covered" data-hits="403" data-linenumber="192">
          <span class="hits">403</span>
          
          <code class="ruby">			success</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">		end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="196">
          <span class="hits">1</span>
          
          <code class="ruby">	def self.convert_to_time(value)</code>
        </li>
      
        <li class="covered" data-hits="662" data-linenumber="197">
          <span class="hits">662</span>
          
          <code class="ruby">		if (value.kind_of?(Numeric) || value.kind_of?(Time) || value.kind_of?(DateTime))</code>
        </li>
      
        <li class="covered" data-hits="647" data-linenumber="198">
          <span class="hits">647</span>
          
          <code class="ruby">			Time.zone.at(value)</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="199">
          <span class="hits">15</span>
          
          <code class="ruby">		elsif (value.is_a?(String) &amp;&amp; /^[\d]+(\.[\d]+){0,1}$/ === value)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="200">
          <span class="hits">6</span>
          
          <code class="ruby">			Time.zone.at(value.to_f)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">		else</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="202">
          <span class="hits">9</span>
          
          <code class="ruby">			Time.zone.parse(value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">		end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">	def convert_rawdata_to_datatype</code>
        </li>
      
        <li class="covered" data-hits="779" data-linenumber="207">
          <span class="hits">779</span>
          
          <code class="ruby">		self.fields.each do |field|</code>
        </li>
      
        <li class="covered" data-hits="865" data-linenumber="208">
          <span class="hits">865</span>
          
          <code class="ruby">			self.data[field.key] = Topic::Field.convert(self.data[field.key], field.datatype) if self.data.has_key?(field.key)</code>
        </li>
      
        <li class="covered" data-hits="779" data-linenumber="209">
          <span class="hits">779</span>
          
          <code class="ruby">		end unless self.fields.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="213">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="214">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby"># Lazily create the index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby"># Usage</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby"># client = Elasticsearch::Client.new log: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby"># client.index  index: &#39;myindex&#39;, type: &#39;mytype&#39;, id: 1, body: { title: &#39;Test&#39; }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby"># # =&gt; {&quot;ok&quot;=&gt;true, &quot;_index&quot;=&gt;&quot;myindex&quot;, ...}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby"># client.search body: { query: { match: { title: &#39;test&#39; } } }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby"># # =&gt; {&quot;took&quot;=&gt;2, ..., &quot;hits&quot;=&gt;{&quot;total&quot;:5, ...}}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="225">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="226">
          
          
          <code class="ruby"># Custom Client</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="227">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby"># require &#39;multi_json&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="229">
          
          
          <code class="ruby"># require &#39;faraday&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="230">
          
          
          <code class="ruby"># require &#39;elasticsearch/api&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="231">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby"># class MySimpleClient</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">#   include Elasticsearch::API</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">#   CONNECTION = ::Faraday::Connection.new url: &#39;http://localhost:9200&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="237">
          
          
          <code class="ruby">#   def perform_request(method, path, params, body)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="238">
          
          
          <code class="ruby">#     puts &quot;--&gt; #{method.upcase} #{path} #{params} #{body}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="239">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="240">
          
          
          <code class="ruby">#     CONNECTION.run_request \</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby">#       method.downcase.to_sym,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">#       path,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby">#       ( body ? MultiJson.dump(body): nil ),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="244">
          
          
          <code class="ruby">#       {&#39;Content-Type&#39; =&gt; &#39;application/json&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="245">
          
          
          <code class="ruby">#   end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="246">
          
          
          <code class="ruby"># end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e665d6db39391f9f762ae7be7e854cf27dea8d6d">
  <div class="header">
    <h3>app/models/sensit/topic/feed/importer.rb</h3>
    <h4><span class="green">96.77 %</span> covered</h4>
    <div>
      <b>62</b> relevant lines. 
      <span class="green"><b>60</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Sensit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class Topic::Feed::Importer</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    include ::ActiveModel::Model</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">        #  extend  ActiveModel::Naming</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">        # extend  ActiveModel::Translation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">        # include ActiveModel::Validations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">        # include ActiveModel::Conversion</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ::ActiveModel::Callbacks</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  include ::ActiveModel::Dirty</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    # include Roo</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_reader :feeds</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_accessor :index</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_accessor :type</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_accessor :fields</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(attributes = {})</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="17">
          <span class="hits">16</span>
          
          <code class="ruby">      @feeds = []</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="18">
          <span class="hits">16</span>
          
          <code class="ruby">      super(attributes)</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="19">
          <span class="hits">16</span>
          
          <code class="ruby">      @errors = ActiveModel::Errors.new(self)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    def feeds=(value)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="23">
          <span class="hits">5</span>
          
          <code class="ruby">      if value.is_a?(Array)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="24">
          <span class="hits">3</span>
          
          <code class="ruby">          @feeds = value.inject([]) do |arr, body|</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="25">
          <span class="hits">8</span>
          
          <code class="ruby">            arr &lt;&lt; Topic::Feed.new(body.merge!({index: self.index, type: self.type, fields: self.fields}))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="27">
          <span class="hits">2</span>
          
          <code class="ruby">      elsif value.is_a?(ActionDispatch::Http::UploadedFile) || value.is_a?(Rack::Test::UploadedFile)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">        @feeds = load_feeds(value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">        raise ::ArgumentError.new(&quot;argument must be an Array of feed parameters or a UploadedFile&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">    def persisted?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">      @feeds.map(&amp;:persisted?).all?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">    def save</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="39">
          <span class="hits">5</span>
          
          <code class="ruby">      unless @feeds.empty?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="40">
          <span class="hits">4</span>
          
          <code class="ruby">        if @feeds.map(&amp;:valid?).all?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="41">
          <span class="hits">3</span>
          
          <code class="ruby">          response = elastic_client.bulk(index: self.index, type: self.type, body: bulk_body)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="42">
          <span class="hits">10</span>
          
          <code class="ruby">          response[&quot;items&quot;].map {|item| item.values.first[&quot;ok&quot;] || item.values.first[&quot;status&quot;] === 201}.all? || false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">          @feeds.each_with_index do |feed, index|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">            feed.errors.full_messages.each do |message|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">              self.errors.add :base, &quot;Row #{index+2}: #{message}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">          false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">        true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">    def load_feeds(file)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">      feed_arr = []</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">      spreadsheets = open_spreadsheets(file)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">      spreadsheets.each do |spreadsheet|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">        header = spreadsheet.shift</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">        # filter out any rows that are not in the fields</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">        temp_fields = self.fields.clone</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="65">
          <span class="hits">4</span>
          
          <code class="ruby">        temp_fields.delete_if {|x| !header.include?(x.key)}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">        spreadsheet.each do |row|</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="68">
          <span class="hits">12</span>
          
          <code class="ruby">          values = temp_fields.inject({}) {|h,field| h.merge!(field.key =&gt; field.convert(row[header.index(field.key)]))}</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="69">
          <span class="hits">3</span>
          
          <code class="ruby">          at = row[header.index(&quot;at&quot;)]</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="70">
          <span class="hits">3</span>
          
          <code class="ruby">          tz = row[header.index(&quot;tz&quot;)]</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="71">
          <span class="hits">3</span>
          
          <code class="ruby">          feed_arr &lt;&lt; Topic::Feed.new({index: self.index, type: self.type, at: at, tz: tz, data: values, fields: self.fields})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="74">
          <span class="hits">4</span>
          
          <code class="ruby">      feed_arr.uniq {|feed| feed.at}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">    def open_spreadsheets(file)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="78">
          <span class="hits">7</span>
          
          <code class="ruby">      case File.extname(file.original_filename)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="79">
          <span class="hits">2</span>
          
          <code class="ruby">        when &quot;.csv&quot; then [::Roo::CSV.new(file.path, file_warning: :ignore).to_a]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">        when &quot;.xls&quot; then [::Roo::Excel.new(file.path, file_warning: :ignore).to_a]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">        when &quot;.xlsx&quot; then [::Roo::Excelx.new(file.path, file_warning: :ignore).to_a]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">        when &quot;.ods&quot; then [::Roo::OpenOffice.new(file.path, file_warning: :ignore).to_a]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">        when &quot;.zip&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">          zf = ::Zip::File.new(file.path)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">          spreadsheets = zf.map do |entry|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">            # puts entry.name</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">            zf.get_input_stream(entry) do |stream|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">                ::CSV.parse(stream.read) if File.extname(entry.name) == &quot;.csv&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">        else raise &quot;Unknown file type: #{file.original_filename}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="95">
          <span class="hits">1</span>
          
          <code class="ruby">    def elastic_client</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="96">
          <span class="hits">2</span>
          
          <code class="ruby">      @client ||= ENV[&#39;ELASTICSEARCH_URL&#39;] ? ::Elasticsearch::Client.new(url: ENV[&#39;ELASTICSEARCH_URL&#39;]) : ::Elasticsearch::Client.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">    def bulk_body</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="100">
          <span class="hits">2</span>
          
          <code class="ruby">      @feeds.map do |feed|</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="101">
          <span class="hits">6</span>
          
          <code class="ruby">        feed.new_record? ? { create: {data: feed.to_hash}} : { update: {_id: feed.id, data: {doc: feed.to_hash}}}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="77e05fedbb4e4166905fb04d0dbd615df8642380">
  <div class="header">
    <h3>app/models/sensit/topic/field.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>77</b> relevant lines. 
      <span class="green"><b>77</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Sensit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class Topic::Field &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    extend ::FriendlyId</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    friendly_id :key, use: [:slugged, :finders]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  	belongs_to :topic</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    ## dynamic validations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    # has_many :data_options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    # data_restrictions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    # max_value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    # min_value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    # inclusion { in: %w(small medium large)}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    # format (regular expression)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    # min_length</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    # max_length</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    # uniqueness</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"># float, double, byte, short, integer, and long are supported by elasticsearch</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"># also suports just date</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    DATATYPES = %w[string integer boolean float datetime timezone uri ip_address, lat_long]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    # other datatypes (latitiude, longitude), identifier, credit_card, bank_account, address, city, country, state, province, postal_code, name, enum</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  	validates_associated :topic</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  	validates :name, presence: true, uniqueness: {scope: :topic_id}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  	validates :key, presence: true, uniqueness: {scope: :topic_id}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">    validates :datatype, inclusion: { in: DATATYPES, message: &quot;%{value} is not a valid datatype&quot; } , :allow_nil =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    # also use the key as part of the decision when deciding the time</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    def guess_datatype(value)</code>
        </li>
      
        <li class="covered" data-hits="83" data-linenumber="34">
          <span class="hits">83</span>
          
          <code class="ruby">      case value.class.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">        # does it have a file extension and a url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">        # does it have an image file extension</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      when &quot;FalseClass&quot;, &quot;TrueClass&quot;</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="38">
          <span class="hits">3</span>
          
          <code class="ruby">        return &quot;boolean&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">      when &quot;Date&quot;, &quot;Time&quot;, &quot;DateTime&quot;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="40">
          <span class="hits">2</span>
          
          <code class="ruby">        return &quot;datetime&quot;        </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      when &quot;Fixnum&quot;, &quot;Float&quot;</code>
        </li>
      
        <li class="covered" data-hits="49" data-linenumber="42">
          <span class="hits">49</span>
          
          <code class="ruby">        if value &gt; 1328000000</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">          # Could be a float, integer or a datetime</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="44">
          <span class="hits">8</span>
          
          <code class="ruby">          time_difference = (value - Time.now.to_f).abs</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="45">
          <span class="hits">8</span>
          
          <code class="ruby">          if (time_difference &lt; 8.days.to_f || (time_difference &lt; 2.years.to_f &amp;&amp; could_be_a_time?)) # is it close to a unix timestamp</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="46">
          <span class="hits">6</span>
          
          <code class="ruby">            return &quot;datetime&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="48">
          <span class="hits">2</span>
          
          <code class="ruby">            return value.class == Fixnum ? &quot;integer&quot; : &quot;float&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="51">
          <span class="hits">41</span>
          
          <code class="ruby">          return value.class == Fixnum ? &quot;integer&quot; : &quot;float&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">      when &quot;String&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">        # does it have a currency symbol</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">        # does it have a unit</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="56">
          <span class="hits">28</span>
          
          <code class="ruby">        bool_val = self.class.to_boolean(value)</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="57">
          <span class="hits">28</span>
          
          <code class="ruby">        return guess_datatype(bool_val) unless bool_val.nil?</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="58">
          <span class="hits">27</span>
          
          <code class="ruby">        num_val = self.class.to_number(value)</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="59">
          <span class="hits">27</span>
          
          <code class="ruby">        return guess_datatype(num_val) unless num_val.nil?</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="60">
          <span class="hits">25</span>
          
          <code class="ruby">            lat_long_val = value.split(&#39;,&#39;)</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="61">
          <span class="hits">25</span>
          
          <code class="ruby">            if (lat_long_val.count == 2)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="62">
          <span class="hits">4</span>
          
          <code class="ruby">              lat_val = self.class.to_number(value[0])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="63">
          <span class="hits">4</span>
          
          <code class="ruby">              long_val = self.class.to_number(value[0])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="64">
          <span class="hits">4</span>
          
          <code class="ruby">              return &quot;lat_long&quot; if lat_val.present? &amp;&amp; long_val.present? &amp;&amp; lat_val &gt;= -90 &amp;&amp; lat_val &lt;= 90 &amp;&amp; long_val &gt;= -180 &amp;&amp; long_val &lt;= 180</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="67">
          <span class="hits">24</span>
          
          <code class="ruby">            begin</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="68">
          <span class="hits">24</span>
          
          <code class="ruby">              time_val = Time.parse(value)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="69">
          <span class="hits">11</span>
          
          <code class="ruby">              return &quot;datetime&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">            rescue ::ArgumentError</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="73">
          <span class="hits">13</span>
          
          <code class="ruby">            return &quot;timezone&quot; if ActiveSupport::TimeZone.zones_map.keys.include?(value)</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="74">
          <span class="hits">12</span>
          
          <code class="ruby">            begin</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="75">
          <span class="hits">12</span>
          
          <code class="ruby">              ip_val = IPAddr.new(value)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">              return &quot;ip_address&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">            rescue ::IPAddr::InvalidAddressError</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="80">
          <span class="hits">11</span>
          
          <code class="ruby">            begin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">              # image_file video_file file</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="82">
          <span class="hits">11</span>
          
          <code class="ruby">              uri_val = ::URI.parse(value)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="83">
          <span class="hits">10</span>
          
          <code class="ruby">              raise URI::InvalidURIError if uri_val.nil? || uri_val.host.nil?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">              return &quot;uri&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">            rescue URI::InvalidURIError</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">              </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="88">
          <span class="hits">10</span>
          
          <code class="ruby">            return &quot;string&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">        nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby"># timezone image_file video_file file</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="95">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.convert(value, type)</code>
        </li>
      
        <li class="covered" data-hits="880" data-linenumber="96">
          <span class="hits">880</span>
          
          <code class="ruby">      case type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">      when &quot;datetime&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">        Sensit::Topic::Feed.convert_to_time(value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">      when &quot;integer&quot;</code>
        </li>
      
        <li class="covered" data-hits="168" data-linenumber="100">
          <span class="hits">168</span>
          
          <code class="ruby">        value.to_i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">      when &quot;float&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">        value.to_f</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">      when &quot;string&quot;</code>
        </li>
      
        <li class="covered" data-hits="686" data-linenumber="104">
          <span class="hits">686</span>
          
          <code class="ruby">        value.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">      when &quot;boolean&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">        self.to_boolean(value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="108">
          <span class="hits">23</span>
          
          <code class="ruby">        value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">    def convert(value)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="113">
          <span class="hits">9</span>
          
          <code class="ruby">      self.class.convert(value, self.datatype)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">    def could_be_a_time?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">      could_be_one_of([&quot;at&quot;, &quot;on&quot;, &quot;date&quot;, &quot;time&quot;])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">    def could_be_one_of(list)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="121">
          <span class="hits">2</span>
          
          <code class="ruby">      temp_key = key ? key.strip.underscore.split(&quot;_&quot;).last : nil</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="122">
          <span class="hits">2</span>
          
          <code class="ruby">      temp_key ? list.include?(temp_key) : true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">    ##</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">    # This method returns the elasticsearch properties based on the datatype for indexing</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">    def properties</code>
        </li>
      
        <li class="covered" data-hits="171" data-linenumber="128">
          <span class="hits">171</span>
          
          <code class="ruby">      case self.datatype</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">      when &quot;timezone&quot; then {type: &quot;string&quot;, index: &quot;not_analyzed&quot;}</code>
        </li>
      
        <li class="covered" data-hits="118" data-linenumber="130">
          <span class="hits">118</span>
          
          <code class="ruby">      when &quot;string&quot; then {type: &quot;string&quot;}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">      when &quot;uri&quot; then {type: &quot;string&quot;, index: &quot;not_analyzed&quot;}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">      when &quot;ip_address&quot; then {type: &quot;ip&quot;}</code>
        </li>
      
        <li class="covered" data-hits="38" data-linenumber="133">
          <span class="hits">38</span>
          
          <code class="ruby">      when &quot;integer&quot; then {type: &quot;integer&quot;}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">      when &quot;boolean&quot; then {type: &quot;boolean&quot;}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">      when &quot;float&quot; then {type: &quot;float&quot;}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">      when &quot;datetime&quot; then {type: &quot;date&quot;, format: &quot;basic_date_time&quot;}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="137">
          <span class="hits">1</span>
          
          <code class="ruby">      when &quot;lat_long&quot; then {type: &quot;geo_point&quot;, &quot;fielddata&quot; =&gt; {format: &quot;compressed&quot;,precision: &quot;1cm&quot;}}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">      else </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="139">
          <span class="hits">8</span>
          
          <code class="ruby">        {}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.to_boolean(value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">      # should I use a regex instead?</code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="147">
          <span class="hits">39</span>
          
          <code class="ruby">      case value.to_s.downcase</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="148">
          <span class="hits">7</span>
          
          <code class="ruby">      when &quot;no&quot;, &quot;false&quot;, &quot;n&quot;, &quot;f&quot; then false</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="149">
          <span class="hits">7</span>
          
          <code class="ruby">      when &quot;yes&quot;, &quot;true&quot;, &quot;y&quot;, &quot;t&quot; then true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">      else nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="154">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.to_number(value)</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="155">
          <span class="hits">36</span>
          
          <code class="ruby">      matches = value.match(/\A[+-]?\d+?(\.\d+)?\Z/)</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="156">
          <span class="hits">36</span>
          
          <code class="ruby">      if matches</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="157">
          <span class="hits">4</span>
          
          <code class="ruby">        matches[1].nil? ? value.to_i : value.to_f</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">        nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ad273722bf19f727e86f65932e46235fbbf34fdf">
  <div class="header">
    <h3>lib/sensit/core/factories.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>49</b> relevant lines. 
      <span class="green"><b>49</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># Read about factories at https://github.com/thoughtbot/factory_girl</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">FactoryGirl.define do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  factory :user, :class =&gt; Sensit::User do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    name ELASTIC_INDEX_NAME</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  factory :application, :class =&gt; ::Doorkeeper::Application do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    sequence :name do |n|</code>
        </li>
      
        <li class="covered" data-hits="218" data-linenumber="11">
          <span class="hits">218</span>
          
          <code class="ruby">      &quot;Application#{n}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">    redirect_uri OAUTH2_REDIRECT_URI</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    # secret &quot;95b63199f75e780fb787549a9551582878181afd15db19c3835daafb6a265ca6&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    # uid &quot;e072c008ab1f1c99b91a503f8e038836e1e5451f843c5443f29eccc27f1a7d63&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  factory :access_grant, :class =&gt; ::Doorkeeper::AccessGrant do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">    resource_owner_id 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    expires_in 600000</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    redirect_uri OAUTH2_REDIRECT_URI</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    scopes &quot;&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">    application </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  factory :field, :class =&gt; Sensit::Topic::Field do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    sequence :name do |n|</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="28">
          <span class="hits">128</span>
          
          <code class="ruby">      &quot;Field#{n}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">    sequence :key do |n|</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="31">
          <span class="hits">12</span>
          
          <code class="ruby">      &quot;key#{n}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    datatype &#39;string&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">    topic</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">	factory :topic, :class =&gt; Sensit::Topic do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">	  sequence :name do |n|</code>
        </li>
      
        <li class="covered" data-hits="165" data-linenumber="39">
          <span class="hits">165</span>
          
          <code class="ruby">	    &quot;Topic#{n}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">	  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">    user</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">    application</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">    factory :topic_with_feeds_and_fields, parent: :topic do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">      ignore do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">        sequence :field_keys do |n|</code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="48">
          <span class="hits">80</span>
          
          <code class="ruby">          [&quot;key#{n}&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">        feeds_count 3</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">      after(:create) do |topic, evaluator|</code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="53">
          <span class="hits">92</span>
          
          <code class="ruby">        key_arr = []</code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="54">
          <span class="hits">92</span>
          
          <code class="ruby">        evaluator.field_keys.each do |key|</code>
        </li>
      
        <li class="covered" data-hits="116" data-linenumber="55">
          <span class="hits">116</span>
          
          <code class="ruby">          field = topic.fields.where(key: key).first</code>
        </li>
      
        <li class="covered" data-hits="116" data-linenumber="56">
          <span class="hits">116</span>
          
          <code class="ruby">          field = FactoryGirl.create(:field, topic: topic, key: key) if field.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="58">
          <span class="hits">92</span>
          
          <code class="ruby">        client = ENV[&#39;ELASTICSEARCH_URL&#39;] ? ::Elasticsearch::Client.new(url: ENV[&#39;ELASTICSEARCH_URL&#39;]) : ::Elasticsearch::Client.new        </code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="59">
          <span class="hits">92</span>
          
          <code class="ruby">        evaluator.feeds_count.times do |i|</code>
        </li>
      
        <li class="covered" data-hits="624" data-linenumber="60">
          <span class="hits">624</span>
          
          <code class="ruby">          values = evaluator.field_keys.inject({}) {|h, key| h.merge!(key =&gt; i)}</code>
        </li>
      
        <li class="covered" data-hits="276" data-linenumber="61">
          <span class="hits">276</span>
          
          <code class="ruby">          Sensit::Topic::Feed.create({index: topic.user.name.parameterize, type: topic.to_param, at: Time.now, :tz =&gt; &quot;UTC&quot;, data: values})</code>
        </li>
      
        <li class="covered" data-hits="276" data-linenumber="62">
          <span class="hits">276</span>
          
          <code class="ruby">          client.indices.refresh(:index =&gt; topic.user.name.parameterize)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">    factory :topic_with_feeds do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">      ignore do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">        feeds_count 3</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">      after(:create) do |topic, evaluator|</code>
        </li>
      
        <li class="covered" data-hits="35" data-linenumber="74">
          <span class="hits">35</span>
          
          <code class="ruby">        key_arr = []</code>
        </li>
      
        <li class="covered" data-hits="35" data-linenumber="75">
          <span class="hits">35</span>
          
          <code class="ruby">        client = ENV[&#39;ELASTICSEARCH_URL&#39;] ? ::Elasticsearch::Client.new(url: ENV[&#39;ELASTICSEARCH_URL&#39;]) : ::Elasticsearch::Client.new</code>
        </li>
      
        <li class="covered" data-hits="35" data-linenumber="76">
          <span class="hits">35</span>
          
          <code class="ruby">        evaluator.feeds_count.times do |i|</code>
        </li>
      
        <li class="covered" data-hits="105" data-linenumber="77">
          <span class="hits">105</span>
          
          <code class="ruby">          Sensit::Topic::Feed.create({index: topic.user.name.parameterize, type: topic.to_param, at: Time.now, :tz =&gt; &quot;UTC&quot;, data: {value1: i}})</code>
        </li>
      
        <li class="covered" data-hits="105" data-linenumber="78">
          <span class="hits">105</span>
          
          <code class="ruby">          client.indices.refresh(:index =&gt; topic.user.name.parameterize)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
      </div>
    </div>
  </body>
</html>
